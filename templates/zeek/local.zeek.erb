#
# /opt/zeek/share/zeek/site/local.zeek
#
# Generated by Chef for <%= node[:fqdn] %>
#

#! Local site policy. Customize as appropriate.
#!
#! This file will not be overwritten when upgrading or reinstalling!


########################
# Zeek Intel
########################

################
# Global
################

<% @global_intel.each do |intel_file, enabled| %>
	<% if enabled %>
redef Intel::read_files += { "<%=intel_file%>" };
@load frameworks/intel/seen
@load frameworks/intel/do_notice
<%= "\@load-sigs #{sig}" %>
	<% else %>
#redef Intel::read_files += { "<%=intel_file%>" };
#@load frameworks/intel/seen
#@load frameworks/intel/do_notice
	<% end %>
<% end %>

################
# Regional
################

<% @regional_intel.each do |intel_file, enabled| %>
	<% if enabled %>
redef Intel::read_files += { "<%=intel_file%>" };
@load frameworks/intel/seen
@load frameworks/intel/do_notice
<%= "\@load-sigs #{sig}" %>
	<% else %>
#redef Intel::read_files += { "<%=intel_file%>" };
#@load frameworks/intel/seen
#@load frameworks/intel/do_notice
	<% end %>
<% end %>

################
# Sensor Group 
# <%= node[:nsm][:sensor_group] %>
################

<% @sensor_group_intel.each do |intel_file, enabled| %>
	<% if enabled %>
redef Intel::read_files += { "<%=intel_file%>" };
@load frameworks/intel/seen
@load frameworks/intel/do_notice
<%= "\@load-sigs #{sig}" %>
	<% else %>
#redef Intel::read_files += { "<%=intel_file%>" };
#@load frameworks/intel/seen
#@load frameworks/intel/do_notice
	<% end %>
<% end %>

################
# Host
################

<% @host_intel.each do |intel_file, enabled| %>
	<% if enabled %>
redef Intel::read_files += { "<%=intel_file%>" };
@load frameworks/intel/seen
@load frameworks/intel/do_notice
<%= "\@load-sigs #{sig}" %>
	<% else %>
#redef Intel::read_files += { "<%=intel_file%>" };
#@load frameworks/intel/seen
#@load frameworks/intel/do_notice
	<% end %>
<% end %>


########################
# Zeek Signatures
########################

################
# Global
################

<% @global_sigs.each do |sig, enabled| %>
	<% if enabled %>
<%= "\@load-sigs #{sig}" %>
	<% else %>
<%= "\#\@load-sigs #{sig}" %>
	<% end %>
<% end %>

################
# Regional
################

<% @regional_sigs.each do |sig, enabled| %>
	<% if enabled %>
<%= "\@load-sigs #{sig}" %>
	<% else %>
<%= "\#\@load-sigs #{sig}" %>
	<% end %>
<% end %>

################
# Sensor Group 
# <%= node[:nsm][:sensor_group] %>
################

<% @sensor_group_sigs.each do |sig, enabled| %>
	<% if enabled %>
<%= "\@load-sigs #{sig}" %>
	<% else %>
<%= "\#\@load-sigs #{sig}" %>
	<% end %>
<% end %>

################
# Host
################

<% @host_sigs.each do |sig, enabled| %>
	<% if enabled %>
<%= "\@load-sigs #{sig}" %>
	<% else %>
<%= "\#\@load-sigs #{sig}" %>
	<% end %>
<% end %>


########################
# Zeek Scripts
########################

################
# Global
################

<% @global.each do |script, enabled| %>
	<% if enabled %>
<%= "\@load #{script}" %>
	<% else %>
<%= "\#\@load #{script}" %>
	<% end %>
<% end %>

################
# Regional
################

<% @regional.each do |script, enabled| %>
	<% if enabled %>
<%= "\@load #{script}" %>
	<% else %>
<%= "\#\@load #{script}" %>
	<% end %>
<% end %>

################
# Sensor Group 
# <%= node[:nsm][:sensor_group] %>
################

<% @sensor_group.each do |script, enabled| %>
	<% if enabled %>
<%= "\@load #{script}" %>
	<% else %>
<%= "\#\@load #{script}" %>
	<% end %>
<% end %>

################
# Host
################

<% @host.each do |script, enabled| %>
	<% if enabled %>
<%= "\@load #{script}" %>
	<% else %>
<%= "\#\@load #{script}" %>
	<% end %>
<% end %>
