{
  "Threads": [
    <% (1..@sniff[:steno][:lb_count]).each do | thread | %>
    <% if @sniff[:steno][:max_directory_files] %>
    { "MaxDirectoryFiles": <%= @sniff[:steno][:max_directory_files] %>
    <% else %>
    { "MaxDirectoryFiles": 750000
    <% end %>
    <% if @sniff[:steno][:disk_free_percentage] %>
    , "DiskFreePercentage": <%= @sniff[:steno][:disk_free_percentage] %>
    <% else %>
    , "DiskFreePercentage": 5
    <% end %>
    , "PacketsDirectory": "/nsm/steno/<%= @sniff[:sensorname] %>/thread<%= thread %>/packets"
    , "IndexDirectory": "/nsm/steno/<%= @sniff[:sensorname] %>/thread<%= thread %>/index"
    }<% if thread != @sniff[:steno][:lb_count] %>,<% end %>
    <% end %>
        
  ]
  , "StenotypePath": "/usr/bin/stenotype"
  , "Interface": "<%= @sniff[:interface] %>"
  , "Port": <%= @local_port %>
  <% if @sniff[:steno][:host] %>
  , "Host": "<%= @sniff[:steno][:host] %>"
  <% else %>
  , "Host": "127.0.0.1"
  <% end %>
  <% if @bpf && not @bpf.empty? %>
    <% if @flags && not @flags.empty? %>
  , "Flags": [<%= @flags %>, "--filter=<%= @bpf %>"]
    <% else %>
  , "Flags": ["--filter=<%= @bpf %>"]
    <% end %>
  <% else %>
  , "Flags": [<%= @flags %>]
  <% end %>
  , "CertPath": "/etc/stenographer/certs"
  <% if @sniff[:steno][:grpc] %>
  , "Rpc": { "CaCert": "/etc/stenographer/certs/rpc/StenoCA.crt"
           , "ServerKey": "/etc/stenographer/certs/rpc/Steno.key"
           , "ServerCert": "/etc/stenographer/certs/rpc/Steno.crt"
           , "ServerPort": <%= @grpc_port %>
           , "ServerPcapPath": "/nsm/steno/<%= @sniff[:sensorname] %>/rpc/"
           , "ServerPcapMaxSize": 1000000000
           , "ClientPcapChunkSize": 1000
           , "ClientPcapMaxSize": 5000000
  }
  <% end %>
}
